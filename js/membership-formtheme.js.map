{"version":3,"sources":["membership-formtheme.js"],"names":["CRM","$","append","payment_processor_ids","console","log","$form","length","$niceForm","prepend","parseStdCiviField","selector","$rowNode","find","hide","rtn","label","input","parseSelect2CiviField","$select","killSelect2","select2","removeClass","addClass","parseComplexCiviField","parseRadiosIntoSelect","on","prop","each","$originalInput","$option","attr","value","text","next","e","preventDefault","click","$selectFix","createStdFields","$label","fields","$appendTo","$container","buildStdContainer","error","yourInformation","a","b","first_name","last_name","email","phone","alterPaymentMethodsAvailable","membershipAmountButtons","$priceset","map","selectedOption","showButtonAsSelected","$btn","parent","siblings","forEach","m","is","whyJoining","html","$payment_processor_selection_ui","$payment_processor_switch_wrapper","paymentDetails","$paymentDetails","$header","$content","selectPaymentMethod","selected_processor_id","val","GoCardless","indexOf","giftAid","$gaRow","$inputs","$yes","eq","$yes_label","$no","$no_label","$helpRow","$intro","slice","$declaration","add","remove","$layout","$inputs_container","gdprFields","$gdpr","$niceGdpr","renameSubmitButton","$submitButtonWrapper","$niceSubmitButton","trigger","$original_billing_payment_block","watchPaymentFields","wrapper","config","childList","subtree","delayed","vitiligoTweakDynamicPaymentFields","observer","disconnect","$billingBlock","vtTweaksDone","$billingAddressSection","after","wrap","themeRadiosAndCheckboxes","join","fadeIn","observe","callback","mutationsList","needToTweakUi","mutation","target","id","window","clearTimeout","setTimeout","MutationObserver","$context","$input","$wrapper","before","findPaymentProcessorRadioForProcessorType","processorType","processorIds","found","match","selected_uk","vt_payment","ddProcessor","updateUi","$inUK","$payment_processor","selectPaymentProcessor","updatePaymentProcessorNames","gcText","stripeText","Stripe","$div","appendTo","name","type","$notInUK","$payment_options","overridePriceSetShowHide"],"mappings":"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","file":"membership-formtheme.js","sourcesContent":["((CRM, $) => $(() => {\n\n'use strict';\n\n  // Bodge for now: @todo\n  $('head').append('<link href=\"https://fonts.googleapis.com/css?family=Arimo\" rel=\"stylesheet\">');\n\n  // The config placeholder here is replaced by php. Do not alter the line below at all.\n  var payment_processor_ids = {};//%config%\n  console.log(payment_processor_ids);\n\n  var $form = $('form#Main');\n  if (!$form.length) {\n    return;\n  }\n\n  const $niceForm = $('<div/>');\n\n  $form.prepend($niceForm);\n\n  function parseStdCiviField(selector) {\n    var $rowNode = $form.find(selector).hide();\n\n    const rtn = {\n      label: $rowNode.find('div.label label'),\n      input: $rowNode.find('div.content input'),\n    };\n    if (rtn.input.length === 0) {\n      rtn.input = $rowNode.find('div.content textarea');\n    }\n    return rtn;\n  }\n  function parseSelect2CiviField(selector) {\n    var $rowNode = $form.find(selector).hide();\n    var $select = $rowNode.find('select');\n    return {\n      label: $rowNode.find('div.label label'),\n      input: killSelect2($select)\n    };\n  }\n  function killSelect2($select) {\n    return $('<div class=\"vt-select-container\"/>').append(\n      $select.select2('destroy').removeClass('crm-select2 crm-chain-select-target crm-form-select').addClass('vt-select')\n    );\n  }\n  function parseComplexCiviField(selector) {\n    var $rowNode = $form.find(selector).hide();\n    return {\n      label: $rowNode.find('div.label label'),\n      input: $rowNode.find('div.content').removeClass('content'),\n    };\n  }\n  function parseRadiosIntoSelect(selector) {\n    var $rowNode = $form.find(selector).hide();\n    const $select = $('<select class=\"vt-select\" />');\n    $select.append(\n      $('<option value=\"\">--Please select--</option>')\n      .on('click', function() { $rowNode.find('input:checked').prop('checked', false); }));\n    $rowNode.find('input[type=\"radio\"]').each(function() {\n      const $originalInput = $(this);\n      $option = $('<option/>').attr('value', this.value).text($originalInput.next('label').text())\n      .on('click', e => { e.preventDefault(); $originalInput.click(); } );\n      $select.append($option);\n    });\n\n    const $selectFix = $('<div class=\"vt-select-container\" />').append($select);\n    return {\n      label: $rowNode.find('div.label label'),\n      input: $selectFix,\n    };\n  }\n  function createStdFields($label, fields, $appendTo) {\n    const $container = buildStdContainer($label, fields);\n    $niceForm.append($container);\n  }\n  function buildStdContainer($label, fields) {\n    const $container = $('<div class=\"vt-container vt-grid1\"></div>');\n\n    if ($label) {\n      $container.append($('<div class=\"vt-label vt-col-1 vt-colspan-1\"></div>').append($label));\n    }\n\n    if (fields.length === 1) {\n      $container.append($('<div class=\"vt-input vt-col-2-span-2\"></div>').append(fields[0]));\n    }\n    else if (fields.length === 2) {\n      $container.append($('<div class=\"vt-input vt-col-2\"></div>').append(fields[0]));\n      $container.append($('<div class=\"vt-input vt-col-3\"></div>').append(fields[1]));\n    }\n    else {\n      console.error(\"fields must be 1 or two big.\", fields);\n    }\n    return $container;\n  }\n\n  function yourInformation() {\n    var a, b;\n    $niceForm.append('<div class=\"vt-your-info\"><h2>Your information</h2><span>*Required fields</span></div>');\n\n    // Add name fields.\n    var first_name = parseStdCiviField('#editrow-first_name');\n    first_name.label.text('Full Name');\n    first_name.input.attr('placeholder', 'First name');\n    var last_name = parseStdCiviField('#editrow-last_name');\n    last_name.input.attr('placeholder', 'Last name');\n    createStdFields(first_name.label, [first_name.input, last_name.input]);\n\n    // Add email\n    var email = parseStdCiviField('#editrow-email-1');\n    email.input.attr('placeholder', 'Email');\n    createStdFields(email.label, [email.input]);\n\n    // Add phone\n    var phone = parseStdCiviField('#editrow-phone-Primary-1');\n    phone.input.attr('placeholder', 'Phone number');\n    phone.label.text('Phone number');\n    createStdFields(phone.label, [phone.input]);\n\n    // address.\n    $niceForm.append('<hr/>');\n    a = parseStdCiviField('#editrow-street_address-Primary');\n    a.label.text('Your address');\n    a.input.attr('placeholder', 'Address line 1*');\n    createStdFields(a.label, [a.input]);\n    // ...\n    a = parseStdCiviField('#editrow-supplemental_address_1-Primary');\n    a.input.attr('placeholder', 'Address line 2*');\n    createStdFields(null, [a.input]);\n    // ...\n    a = parseStdCiviField('#editrow-city-Primary');\n    a.input.attr('placeholder', 'Town/City');\n    b = parseSelect2CiviField('#editrow-state_province-Primary');\n    createStdFields(null, [a.input, b.input]);\n    // ...\n    a = parseStdCiviField('#editrow-postal_code-Primary');\n    a.input.attr('placeholder', 'Postcode*');\n    b = parseSelect2CiviField('#editrow-country-Primary');\n    createStdFields(null, [a.input, b.input]);\n    // We also need to hook up the country selector to the payment selector logic.\n    b.input.find('select').on('change', alterPaymentMethodsAvailable);\n\n\n    $niceForm.append('<hr/>');\n    // DOB\n    a = parseComplexCiviField('#editrow-birth_date');\n    a.input.find('.crm-clear-link').hide();\n    createStdFields(a.label, [a.input, null]);\n\n    // Ethnicity\n    a = parseSelect2CiviField('#editrow-custom_14');\n    b = parseStdCiviField('#editrow-custom_15');\n    b.input.attr('placeholder', 'Other'); // Q. how to be reactive to an existing select2 element? @todo\n    createStdFields(a.label, [a.input, b.input]);\n\n    a = parseRadiosIntoSelect('#editrow-gender_id');\n    createStdFields(a.label, [a.input, null]);\n\n    // Do you have Vitiligo.\n    a = parseRadiosIntoSelect('#editrow-custom_16');\n    createStdFields(a.label, [a.input, null]);\n\n  }\n  function membershipAmountButtons() {\n    var a, b;\n    var $priceset = $('#priceset').hide();\n    // @todo match these with price set ids.\n    const map = [\n      ['#price_7_7', '£25'],\n      ['#price_7_a', '£50'],\n      ['#price_7_b', '£100'],\n      ['#price_7_c', '£250'],\n      ['#price_7_d', '£500'],\n    ];\n    const $container = $('<div class=\"vt-container vt-amount-buttons\"></div>');\n    // @todo set defaults.\n    var selectedOption;\n    function showButtonAsSelected($btn) {\n      $btn.addClass('selected').parent().siblings().find('button').removeClass('selected');\n    }\n    map.forEach(m => {\n      const $btn = $('<button/>')\n        .attr('data-input-selector', m[0])\n        .text(m[1])\n        .on('click', function(e) {\n          e.preventDefault();\n          $(m[0]).click();\n          showButtonAsSelected($(this));\n        });\n      $container.append(\n        $('<div class=\"vt-amount-buttons__button\"></div>')\n        .append($btn)\n      );\n      if ($(m[0]).is(':checked')) {\n        selectedOption= m[0];\n      }\n    });\n    if (!selectedOption) {\n      // @todo set this to actual default price set id.\n      // Nb. might be different for membership/donation.\n      selectedOption = '#price_7_b';\n    }\n    // Initial show selected button.\n    showButtonAsSelected($container.find('button[data-input-selector=\"' + selectedOption + '\"]'));\n\n    $niceForm.append('<h3 class=\"vt-heading vt-heading--smaller-grey1\">My contribution</h3>');\n    $niceForm.append($container);\n    $niceForm.append('<div>Annual membership renews automatically, can be cancelled upto 14 days before renewal date</div>');\n    $niceForm.append('<hr/>');\n  }\n  function whyJoining() {\n    var a, b;\n    a = parseStdCiviField('#editrow-custom_17');\n    a.label.html(\"<h3 class='vt-heading'>Why are you signing up to membership with the Vitiligo Society?</h3>\");\n    $niceForm.append($('<div class=\"vt-container\"/>').append(a.label, a.input), '<hr/>');\n  }\n  const $payment_processor_selection_ui = $form.find(\"fieldset.payment_options-group\");\n  var $payment_processor_switch_wrapper; // set in paymentDetails()\n  function paymentDetails() {\n    $payment_processor_selection_ui.hide();\n\n    const $paymentDetails = $('<div class=\"vt-payment-box\"/>');\n    const $header = $(`<div class=\"vt-payment-box__header\">\n      <div class=\"vt-payment-box__gbp\"><i class=\"vt-icon vt-icon--gbp-circle\"></i></div>\n      <h3 class=\"vt-payment-box__heading\">Your payment details</h3>\n      <div class=\"vt-payment-box__payby\">Pay by:</div>\n      <div class=\"vt-payment-box__switch-container\">\n        <div class=\"vt-payment-box__switch-wrapper\">\n          <label class=\"vt-payment-box__dd\" for=\"CIVICRM_QFID_11_payment_processor_id\">Direct Debit</label>\n          <label class=\"vt-payment-box__c\" for=\"CIVICRM_QFID_9_payment_processor_id\">Card</label>\n        </div>\n      </div>\n      `);\n    const $content = $('<div class=\"vt-payment-box__content\"/>');\n    $payment_processor_switch_wrapper = $header.find('.vt-payment-box__switch-wrapper');\n    $paymentDetails.append($header, $content);\n    $content.append($form.find('#billing-payment-block'));\n    $payment_processor_selection_ui.find('input').on('click', selectPaymentMethod);\n    $payment_processor_switch_wrapper.find('label').on('click', selectPaymentMethod);\n    $niceForm.append($paymentDetails);\n    selectPaymentMethod();\n  }\n  function selectPaymentMethod() {\n    const selected_processor_id = $payment_processor_selection_ui.find('input:checked').val();\n    console.log(\"selectPaymentMethod running \", selected_processor_id);\n    if (payment_processor_ids.GoCardless.indexOf(selected_processor_id) > -1) {\n      $payment_processor_switch_wrapper.addClass('selected-dd').removeClass('selected-c');\n    }\n    else {\n      $payment_processor_switch_wrapper.addClass('selected-c').removeClass('selected-dd');\n    }\n  }\n  function giftAid() {\n    //editrow-custom_10\n    const $gaRow = $('#editrow-custom_10');\n    const $inputs = $gaRow.find('input');\n    const $yes = $inputs.eq(0);\n    const $yes_label = $yes.next();\n    const $no = $inputs.eq(1);\n    const $no_label = $no.next();\n    const $helpRow = $('#helprow-custom_10>div');\n    const $intro = $helpRow.find('>p').slice(3,5);\n    const $declaration = $helpRow.find('p').eq(0).add($helpRow.find('ol').eq(0));\n\n    // Remove the remaining help text.\n    $helpRow.remove();\n\n    // Remove the third input (\"Yes, in the past 4 years\")\n    $inputs.eq(2).parent().parent().remove();\n\n    // Now re-assemble.\n    const $container = $('<div class=\"vt-container\"></div>');\n    $container.append('<h3 class=\"vt-heading\">Gift Aid</h3>', $intro);\n    // Now the grid layout\n    const $layout = $('<div class=\"vt-giftaid-layout-1\"/>');\n    const $inputs_container = $('<div class=\"vt-giftaid-inputs\" />');\n    $inputs_container.append($yes, $yes_label, $no, $no_label);\n    $layout.append($inputs_container, $('<div class=\"vt-giftaid-declaration\"/>').append($declaration));\n    $container.append($layout);\n    $niceForm.append($container, '<hr/>');\n\n  }\n  function gdprFields() {\n    const $gdpr = $('#gdpr-terms-conditions');\n    const $niceGdpr = $('<div class=\"vt-gdpr\"></div>');\n    $niceGdpr.append($('<div class=\"vt-gdpr__text\"/>').append('<h2>Terms and conditions</h2>', $gdpr.find('.terms-conditions-acceptance-intro')));\n\n    $niceGdpr.append($gdpr.find('.terms-conditions-item'));\n\n    $niceForm.append($niceGdpr);\n    $gdpr.remove();\n  }\n  function renameSubmitButton(text) {\n    // Hide the original button, make a new button which clicks it by JS.\n    const $submitButtonWrapper = $form.find('#crm-submit-buttons input').parent().hide();\n\n    const $niceSubmitButton = $('<button class=\"vt-submit\"/>')\n      .text(text)\n      .on('click', e => {e.preventDefault();$submitButtonWrapper.find('input[type=\"submit\"]').trigger('click');});\n\n    $niceForm.append($niceSubmitButton);\n  }\n  /**\n   * We need to look out for changes that are interactively made by CiviCRM.\n   */\n  // CiviCRM ends up creating nested versions of this :-(\n  // So make a reference to the original.\n  const $original_billing_payment_block = $('#billing-payment-block');\n  function watchPaymentFields() {\n    const wrapper = $original_billing_payment_block[0];\n    const config = { childList: true, subtree: true };\n    var delayed = false;\n\n    // This function deals with re-presenting card payment fields in the billing-payment-block\n    const vitiligoTweakDynamicPaymentFields = function() {\n      observer.disconnect();\n      console.log(\"Tweaking form ...\");\n\n      // Reconfigure payment block.\n      // Remove the non-unique id from the billing-payment-block.\n      $original_billing_payment_block.find('#billing-payment-block').attr('id', 'nested-billing-payment-block');\n      const $billingBlock = $original_billing_payment_block;\n      if ($billingBlock[0].vtTweaksDone) {\n        console.log(\"Already tweaked it.\");\n      }\n      $billingBlock[0].vtTweaksDone = true;\n      // We'll use this existing container for the address fields.\n      const $billingAddressSection = $billingBlock.find('.billing_name_address-section');\n\n      $billingBlock.find('.credit_card_number-section').after(\n        $('<div class=\"direct-debit-benefits-para\"><div class=\"dashed\" ><i class=\"vt-icon vt-icon--info\"></i>Para on benefits of DD.</div><i class=\"vt-icon vt-icon--padlock\"></i></div>')\n      );\n      // Strip out some CiviCRM classes that give us grief.\n      $billingBlock.find('.crm-section').removeClass('crm-section');\n      $billingBlock.find('div.label').removeClass('label').addClass('vt-payment-label');\n      $billingBlock.find('div.content').removeClass('content').addClass('vt-container');\n      $billingBlock.find('.clear').remove();\n\n\n      // Re-class the selects.\n      $billingBlock.find('#credit_card_exp_date_M, #credit_card_exp_date_Y')\n        .addClass('vt-select')\n        .wrap('<div class=\"vt-select-container vt-card-expiry\"/>');\n\n      // If we have a billingAddressSection we need to theme that now.\n      if ($billingAddressSection.length) {\n        // ... add a title and move the 'same as above' checkbox.\n        $billingAddressSection.append('<h2>Your billing information</h2>',\n          $billingBlock.find('#billingcheckbox'),\n          $billingBlock.find('label[for=\"billingcheckbox\"]')\n        );\n        // Theme the \"My billing address is same...\"\n        themeRadiosAndCheckboxes($billingAddressSection);\n\n        // Move the Name fields.\n        $billingAddressSection.append(buildStdContainer(\n          $billingBlock.find('.billing_first_name-section label').text('Name on card'),\n          [\n            $billingBlock.find('.billing_first_name-section input'),\n            $billingBlock.find('.billing_last_name-section input'),\n          ]\n        ));\n\n        // Move Street addres.,\n        $billingAddressSection.append(buildStdContainer(\n          $billingBlock.find('.billing_street_address-5-section label').text('Address'),\n          [$billingBlock.find('.billing_street_address-5-section input').attr('placeholder', 'Address line 1*')]\n        ));\n\n        // Move City., county.\n        $billingAddressSection.append(buildStdContainer(\n          null,\n          [\n            $billingBlock.find('.billing_city-5-section input').attr('placeholder', 'Town/City'),\n            killSelect2($billingBlock.find('.billing_state_province_id-5-section select'))\n          ]\n        ));\n\n        // Move Post code, country.\n        $billingAddressSection.append(buildStdContainer(\n          null,\n          [\n            $billingBlock.find('.billing_postal_code-5-section input').attr('placeholder', 'Postcode'),\n            killSelect2($billingBlock.find('.billing_country_id-5-section select'))\n          ]\n        ));\n\n        // Hide left over crud.\n        $billingBlock.find([\n          '.billing_first_name-section',\n          '.billing_middle_name-section',\n          '.billing_last_name-section',\n          '.billing_street_address-5-section',\n          '.billing_city-5-section',\n          '.billing_state_province_id-5-section',\n          '.billing_postal_code-5-section',\n          '.billing_country_id-5-section',\n        ].join(',')).hide();\n      }\n\n\n      console.log(\"End tweaks. Showing payment block again and reconnecting observer\");\n      $original_billing_payment_block.fadeIn('fast');\n      observer.observe(wrapper, config);\n    };\n\n    // This callback is used in the mutation observer.\n    // Its job is to identify if a DOM mutation is relevant to the billing payment block.\n    // If so it will call vitiligoTweakDynamicPaymentFields after half a second.\n    const callback = function(mutationsList, observer) {\n      var needToTweakUi = false;\n      for(var mutation of mutationsList) {\n\t\t\t\t// We need to detect whether the change was the payment block.\n\t\t\t\tif (mutation.target.id == 'billing-payment-block') {\n          needToTweakUi = true;\n\t\t\t\t}\n      }\n\n      if (needToTweakUi) {\n        console.log(\"Found billing-payment-block in mutation targets\", mutationsList);\n        // Note CiviCRM ends up creating nested #billing-payment-block elements :-(\n\n        // Hide the element while we build this and mess it around.\n        $original_billing_payment_block.hide();\n\n        // If already queued, requeue with new delay.\n        if (delayed) {\n          window.clearTimeout(delayed);\n          delayed = false;\n        }\n        // Allow some time for things to settle.\n        delayed = window.setTimeout(vitiligoTweakDynamicPaymentFields, 500);\n      }\n    };\n\n    // Create an observer instance linked to the callback function\n    const observer = new MutationObserver(callback);\n\n    // Start observing the target node for configured mutations\n    observer.observe(wrapper, config);\n  }\n  function themeRadiosAndCheckboxes($context) {\n    $context.find('input[type=\"radio\"], input[type=\"checkbox\"]').each(function() {\n      const $input = $(this);\n      if ($input.is('.vt-themed')) {\n        return;\n      }\n      const $label = $input.next();\n      const $wrapper = $('<div class=\"vt-checkbox-radio-wrapper\"/>');\n      if ($input.is('input[type=\"checkbox\"]')) {\n        $wrapper.addClass('checkbox');\n      }\n      else {\n        $wrapper.addClass('radio');\n      }\n      $input.before($wrapper);\n      $wrapper.append($input, $label);\n      $input.addClass('vt-themed');\n    });\n  }\n  // Returns DOM node.\n  function findPaymentProcessorRadioForProcessorType(processorType) {\n    var processorIds = payment_processor_ids[processorType] || [];\n\n    var found;\n    $('fieldset.payment_options-group [name=\"payment_processor_id\"]').each(function() {\n      var m =this.id.match(/CIVICRM_QFID_(\\d+)_payment_processor_id$/);\n      if (m && m.length === 2 && processorIds.indexOf(m[1])>-1) {\n        found = this;\n      }\n    });\n\n    return found;\n  }\n  function alterPaymentMethodsAvailable() {\n    const selected_uk = 'United Kingdom' === $('#country-Primary option:selected').text();\n    const selected_processor_id = $form.find('fieldset.payment_options-group input:checked').val();\n    const vt_payment = $('.vt-payment-box');\n    const ddProcessor = $(findPaymentProcessorRadioForProcessorType('GoCardless'));\n    console.log({selected_uk, selected_processor_id,vt_payment,ddProcessor});\n    if (selected_uk) {\n      // Allow DD and Card.\n      vt_payment.removeClass('disable-dd');\n    }\n    else {\n      // Disable DD payments.\n      vt_payment.addClass('disable-dd');\n      // If currently selected processor is DD then do the change now.\n      if (ddProcessor.is(':checked')) {\n        // Need to change it.\n        $(findPaymentProcessorRadioForProcessorType('Stripe')).click();\n        selectPaymentMethod();\n      }\n    }\n    // Now disable DD radio input unless in uk.\n    // This is done for accessibility reasons - visual users will already not\n    // have a way to select those.\n    $(ddProcessor).prop('disabled', !selected_uk);\n  }\n\n\n  membershipAmountButtons();\n  yourInformation();\n  whyJoining();\n  paymentDetails();\n  giftAid();\n  gdprFields();\n  renameSubmitButton('Join');\n  themeRadiosAndCheckboxes($('body'));\n  watchPaymentFields();\n  // Remove left over elements.\n  $('fieldset.crm-profile-name-name_and_address').remove();\n  return;\n\n  // Create UK radios.\n  function updateUi() {\n    if ($inUK.is(\":checked\")) {\n      // Show all options.\n      $payment_processor.fadeIn('fast');\n      // Nudge user to GoCardless.\n      selectPaymentProcessor('GoCardless');\n      updatePaymentProcessorNames('Direct Debit - more of your money goes to the Vitiligo Society', 'Recurring credit/debit card payment');\n    }\n    else {\n      // Select Stripe.\n      $payment_processor.hide(); // Normally hidden anyway, but just in case user changes mind on UKness.\n      // Force user to use Stripe; GC not relevant outside UK.\n      selectPaymentProcessor('Stripe');\n      updatePaymentProcessorNames('', 'Recurring credit/debit card payment');\n    }\n  }\n\n  /**\n   * Find and click the input for either 'stripe' or 'gocardless' payment\n   * processor based on configured Payment Processor Ids.\n   */\n  function selectPaymentProcessor(processorType) {\n    var found;\n    var processorIds = payment_processor_ids[processorType] || [];\n\n    $payment_processor.find('[name=\"payment_processor_id\"]').each(function() {\n      var m =this.id.match(/CIVICRM_QFID_(\\d+)_payment_processor_id$/);\n      if (m && m.length === 2 && processorIds.indexOf(m[1])>-1) {\n        found = this;\n      }\n    });\n\n    $(found).trigger('click');\n  }\n  /**\n   * Update hints on the processor names.\n   */\n  function updatePaymentProcessorNames(gcText, stripeText) {\n    $payment_processor.find('[name=\"payment_processor_id\"]').each(function() {\n      var m =this.id.match(/CIVICRM_QFID_(\\d+)_payment_processor_id$/);\n      if (m && m.length === 2) {\n        // Got processor ID. Is it stripe or GoCardless?\n        if (payment_processor_ids.GoCardless.indexOf(m[1]) > -1) {\n          // GoCardless.\n          $(this).next().text(gcText);\n\n        }\n        else if (payment_processor_ids.Stripe.indexOf(m[1]) > -1) {\n          // Stripe.\n          $(this).next().text(stripeText);\n        }\n\n        if ($(this).next().next().prop('tagName') !== 'BR') {\n          // Insert line break before input.\n          $(this).next().next().before('<br/>');\n        }\n      }\n    });\n\n  }\n\n  // Copy CiviCRM's default HTML structure.\n  var $container = $('<div/>').addClass('crm-public-form-item crm-section');\n  $container.append($('<div/>').addClass('label'));\n  var $div = $('<div/>').addClass('content').appendTo($container);\n  $container.append($('<div/>').addClass('clear'));\n\n  var $inUK = $('<input/>')\n    .attr({id: 'in-uk-yes', value: '1', name: 'in-uk', type:'radio'})\n    .on('click', updateUi)\n    .appendTo($div);\n  $('<label/>')\n    .attr('for', 'in-uk-yes')\n    .text(\"I'm in the UK\")\n    .appendTo($div);\n  var $notInUK = $('<input/>')\n    .attr({id: 'in-uk-no', value: '0', name: 'in-uk', type:'radio'})\n    .on('click', updateUi)\n    .appendTo($div);\n  $('<label/>')\n    .attr('for', 'in-uk-no')\n    .text(\"I'm not in the UK\")\n    .appendTo($div);\n\n\n  var $payment_options = $form.find('.payment_options-group');\n  var $payment_processor = $payment_options.find('.payment_processor-section');\n  $payment_processor.hide().before($container);\n\n\n  // Finally, we need to override CiviCRM's events on the price set selection.\n  function overridePriceSetShowHide() {\n    if (!$inUK.is(':checked') && !$notInUK.is(':checked')) {\n      // Neither UK nor not UK is checked, so hide the other options for now.\n      $payment_processor.hide();\n    }\n  }\n  // Apply this when the price set is clicked.\n  $('.price-set-option-content input[type=\"radio\"]').on('click', function() {\n    overridePriceSetShowHide();\n    // In case we are not called first, repeat this after giving 50ms for other processes to work.\n    setTimeout(overridePriceSetShowHide, 50);\n  });\n\n}))(CRM, CRM.$);\n\n"]}