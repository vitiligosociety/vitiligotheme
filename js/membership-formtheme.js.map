{"version":3,"sources":["membership-formtheme.js"],"names":["CRM","$","payment_processor_ids","$form","length","$niceForm","prepend","parseStdCiviField","selector","$rowNode","find","hide","label","input","parseSelectCiviField","removeClass","createStdFields","$label","fields","$container","append","console","error","yourInformation","a","b","first_name","text","attr","last_name","email","phone","updateUi","$inUK","is","$payment_processor","fadeIn","selectPaymentProcessor","updatePaymentProcessorNames","processorType","found","processorIds","each","m","id","match","indexOf","trigger","gcText","stripeText","GoCardless","next","Stripe","prop","before","addClass","$div","appendTo","value","name","type","on","$notInUK","$payment_options","overridePriceSetShowHide","setTimeout"],"mappings":"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","file":"membership-formtheme.js","sourcesContent":["((CRM, $) => $(() => {\n\n'use strict';\n\n  // The config placeholder here is replaced by php. Do not alter the line below at all.\n  var payment_processor_ids = {};//%config%\n\n  var $form = $('form#Main');\n  if (!$form.length) {\n    return;\n  }\n\n  const $niceForm = $('<div/>');\n\n  $form.prepend($niceForm);\n\n  function parseStdCiviField(selector) {\n    var $rowNode = $form.find(selector).hide();\n\n    return {\n      label: $rowNode.find('div.label label'),\n      input: $rowNode.find('div.content input'),\n    };\n  }\n  function parseSelectCiviField(selector) {\n    var $rowNode = $form.find(selector).hide();\n    return {\n      label: $rowNode.find('div.label label'),\n      input: $rowNode.find('div.content').removeClass('content'),\n    };\n  }\n  function createStdFields($label, fields) {\n    const $container = $('<div class=\"vt-container vt-grid1\"></div>');\n\n    if ($label) {\n      $container.append($('<div class=\"vt-label vt-col-1 vt-colspan-1\"></div>').append($label));\n    }\n\n    if (fields.length === 1) {\n      $container.append($('<div class=\"vt-input vt-col-2-span-2\"></div>').append(fields[0]));\n    }\n    if (fields.length === 2) {\n      $container.append($('<div class=\"vt-input vt-col-2\"></div>').append(fields[0]));\n      $container.append($('<div class=\"vt-input vt-col-3\"></div>').append(fields[1]));\n    }\n    else {\n      console.error(\"fields must be 1 or two big.\");\n    }\n    $niceForm.append($container);\n  }\n\n  function yourInformation() {\n    var a, b;\n\n    // Add name fields.\n    var first_name = parseStdCiviField('#editrow-first_name');\n    first_name.label.text('Full Name');\n    first_name.input.attr('placeholder', 'First name');\n    var last_name = parseStdCiviField('#editrow-last_name');\n    last_name.input.attr('placeholder', 'Last name');\n    createStdFields(first_name.label, [first_name.input, last_name.input]);\n\n    // Add email\n    var email = parseStdCiviField('#editrow-email-1');\n    email.input.attr('placeholder', 'Email');\n    createStdFields(email.label, [email.input]);\n\n    // Add phone\n    var phone = parseStdCiviField('#editrow-phone-Primary-1');\n    phone.input.attr('placeholder', 'Phone number');\n    phone.label.text('Phone number');\n    createStdFields(phone.label, [phone.input]);\n\n    // address.\n    $niceForm.append('<hr/>');\n    a = parseStdCiviField('#editrow-street_address-Primary');\n    a.label.text('Your address');\n    a.input.attr('placeholder', 'Address line 1*');\n    createStdFields(a.label, [a.input]);\n    // ...\n    a = parseStdCiviField('#editrow-supplemental_address_1-Primary');\n    a.input.attr('placeholder', 'Address line 2*');\n    createStdFields(null, [a.input]);\n    // ...\n    a = parseStdCiviField('#editrow-city-Primary');\n    a.input.attr('placeholder', 'Town/City');\n    b = parseSelectCiviField('#editrow-state_province-Primary');\n    createStdFields(null, [a.input, b.input]);\n    // ...\n    a = parseStdCiviField('#editrow-postal_code-Primary');\n    a.input.attr('placeholder', 'Postcode*');\n    b = parseSelectCiviField('#editrow-country-Primary');\n    createStdFields(null, [a.input, b.input]);\n\n    $niceForm.append('<hr/>');\n    // DOB\n    a = parseSelectCiviField('#editrow-birth_date');\n    a.input.find('.crm-clear-link').hide();\n    createStdFields(a.label, [a.input, null]);\n\n    // Ethnicity\n    a = parseSelectCiviField('#editrow-custom_14');\n    b = parseStdCiviField('#editrow-custom_15');\n    b.input.attr('placeholder', 'Other'); // Q. how to be reactive to an existing select2 element? @todo\n\n    // Gender, Do you have Vitiligo @todo these need transforming from radio buttons to selects!\n\n  }\n\n  yourInformation();\n  return;\n\n  // Create UK radios.\n  function updateUi() {\n    if ($inUK.is(\":checked\")) {\n      // Show all options.\n      $payment_processor.fadeIn('fast');\n      // Nudge user to GoCardless.\n      selectPaymentProcessor('GoCardless');\n      updatePaymentProcessorNames('Direct Debit - more of your money goes to the Vitiligo Society', 'Recurring credit/debit card payment');\n    }\n    else {\n      // Select Stripe.\n      $payment_processor.hide(); // Normally hidden anyway, but just in case user changes mind on UKness.\n      // Force user to use Stripe; GC not relevant outside UK.\n      selectPaymentProcessor('Stripe');\n      updatePaymentProcessorNames('', 'Recurring credit/debit card payment');\n    }\n  }\n\n  /**\n   * Find and click the input for either 'stripe' or 'gocardless' payment\n   * processor based on configured Payment Processor Ids.\n   */\n  function selectPaymentProcessor(processorType) {\n    var found;\n    var processorIds = payment_processor_ids[processorType] || [];\n\n    $payment_processor.find('[name=\"payment_processor_id\"]').each(function() {\n      var m =this.id.match(/CIVICRM_QFID_(\\d+)_payment_processor_id$/);\n      if (m && m.length === 2 && processorIds.indexOf(m[1])>-1) {\n        found = this;\n      }\n    });\n\n    $(found).trigger('click');\n  }\n  /**\n   * Update hints on the processor names.\n   */\n  function updatePaymentProcessorNames(gcText, stripeText) {\n    $payment_processor.find('[name=\"payment_processor_id\"]').each(function() {\n      var m =this.id.match(/CIVICRM_QFID_(\\d+)_payment_processor_id$/);\n      if (m && m.length === 2) {\n        // Got processor ID. Is it stripe or GoCardless?\n        if (payment_processor_ids.GoCardless.indexOf(m[1]) > -1) {\n          // GoCardless.\n          $(this).next().text(gcText);\n\n        }\n        else if (payment_processor_ids.Stripe.indexOf(m[1]) > -1) {\n          // Stripe.\n          $(this).next().text(stripeText);\n        }\n\n        if ($(this).next().next().prop('tagName') !== 'BR') {\n          // Insert line break before input.\n          $(this).next().next().before('<br/>');\n        }\n      }\n    });\n\n  }\n\n  // Copy CiviCRM's default HTML structure.\n  var $container = $('<div/>').addClass('crm-public-form-item crm-section');\n  $container.append($('<div/>').addClass('label'));\n  var $div = $('<div/>').addClass('content').appendTo($container);\n  $container.append($('<div/>').addClass('clear'));\n\n  var $inUK = $('<input/>')\n    .attr({id: 'in-uk-yes', value: '1', name: 'in-uk', type:'radio'})\n    .on('click', updateUi)\n    .appendTo($div);\n  $('<label/>')\n    .attr('for', 'in-uk-yes')\n    .text(\"I'm in the UK\")\n    .appendTo($div);\n  var $notInUK = $('<input/>')\n    .attr({id: 'in-uk-no', value: '0', name: 'in-uk', type:'radio'})\n    .on('click', updateUi)\n    .appendTo($div);\n  $('<label/>')\n    .attr('for', 'in-uk-no')\n    .text(\"I'm not in the UK\")\n    .appendTo($div);\n\n\n  var $payment_options = $form.find('.payment_options-group');\n  var $payment_processor = $payment_options.find('.payment_processor-section');\n  $payment_processor.hide().before($container);\n\n\n  // Finally, we need to override CiviCRM's events on the price set selection.\n  function overridePriceSetShowHide() {\n    if (!$inUK.is(':checked') && !$notInUK.is(':checked')) {\n      // Neither UK nor not UK is checked, so hide the other options for now.\n      $payment_processor.hide();\n    }\n  }\n  // Apply this when the price set is clicked.\n  $('.price-set-option-content input[type=\"radio\"]').on('click', function() {\n    overridePriceSetShowHide();\n    // In case we are not called first, repeat this after giving 50ms for other processes to work.\n    setTimeout(overridePriceSetShowHide, 50);\n  });\n\n}))(CRM, CRM.$);\n\n"]}