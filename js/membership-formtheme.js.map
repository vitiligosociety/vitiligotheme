{"version":3,"sources":["membership-formtheme.js"],"names":["CRM","$","payment_processor_ids","$form","length","$niceForm","console","log","prepend","parseStdCiviField","selector","$rowNode","find","label","input","createStdFields","$label","fields","$container","append","error","yourInformation","first_name","text","attr","last_name","email","phone","updateUi","$inUK","is","$payment_processor","fadeIn","selectPaymentProcessor","updatePaymentProcessorNames","hide","processorType","found","processorIds","each","m","id","match","indexOf","trigger","gcText","stripeText","GoCardless","next","Stripe","prop","before","addClass","$div","appendTo","value","name","type","on","$notInUK","$payment_options","overridePriceSetShowHide","setTimeout"],"mappings":"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","file":"membership-formtheme.js","sourcesContent":["((CRM, $) => $(() => {\n\n'use strict';\n\n  // The config placeholder here is replaced by php. Do not alter the line below at all.\n  var payment_processor_ids = {};//%config%\n\n  var $form = $('form#Main');\n  if (!$form.length) {\n    return;\n  }\n\n  const $niceForm = $('<div/>');\n  console.log($niceForm);\n\n  $form.prepend($niceForm);\n\n  function parseStdCiviField(selector) {\n    var $rowNode = $form.find(selector);\n    return {\n      label: $rowNode.find('div.label label'),\n      input: $rowNode.find('div.content input'),\n    };\n  }\n  function createStdFields($label, fields) {\n    const $container = $('<div class=\"vt-container vt-grid1\"></div>');\n\n    $container.append($('<div class=\"vt-label vt-col-1 vt-colspan-1\"></div>').append($label));\n\n    if (fields.length === 1) {\n      $container.append($('<div class=\"vt-input vt-col-2-span-2\"></div>').append(fields[0]));\n    }\n    if (fields.length === 2) {\n      $container.append($('<div class=\"vt-input vt-col-2\"></div>').append(fields[0]));\n      $container.append($('<div class=\"vt-input vt-col-3\"></div>').append(fields[1]));\n    }\n    else {\n      console.error(\"fields must be 1 or two big.\");\n    }\n    $niceForm.append($container);\n  }\n\n  function yourInformation() {\n\n    // Add name fields.\n    var first_name = parseStdCiviField('#editrow-first_name');\n    first_name.label.text('Full Name');\n    first_name.input.attr('placeholder', 'First name');\n    var last_name = parseStdCiviField('#editrow-last_name');\n    last_name.input.attr('placeholder', 'Last name');\n    createStdFields(first_name.label, [first_name.input, last_name.input]);\n\n    // Add email\n    var email = parseStdCiviField('#editrow-email-1');\n    email.input.attr('placeholder', 'Email');\n    createStdFields(email.label, [email.input]);\n\n    // Add phone\n    var phone = parseStdCiviField('#editrow-phone-Primary-1');\n    phone.input.attr('placeholder', 'Phone number');\n    phone.label.text('Phone number');\n    createStdFields(phone.label, [phone.input]);\n  }\n\n  yourInformation();\n  return;\n\n  // Create UK radios.\n  function updateUi() {\n    if ($inUK.is(\":checked\")) {\n      // Show all options.\n      $payment_processor.fadeIn('fast');\n      // Nudge user to GoCardless.\n      selectPaymentProcessor('GoCardless');\n      updatePaymentProcessorNames('Direct Debit - more of your money goes to the Vitiligo Society', 'Recurring credit/debit card payment');\n    }\n    else {\n      // Select Stripe.\n      $payment_processor.hide(); // Normally hidden anyway, but just in case user changes mind on UKness.\n      // Force user to use Stripe; GC not relevant outside UK.\n      selectPaymentProcessor('Stripe');\n      updatePaymentProcessorNames('', 'Recurring credit/debit card payment');\n    }\n  }\n\n  /**\n   * Find and click the input for either 'stripe' or 'gocardless' payment\n   * processor based on configured Payment Processor Ids.\n   */\n  function selectPaymentProcessor(processorType) {\n    var found;\n    var processorIds = payment_processor_ids[processorType] || [];\n\n    $payment_processor.find('[name=\"payment_processor_id\"]').each(function() {\n      var m =this.id.match(/CIVICRM_QFID_(\\d+)_payment_processor_id$/);\n      if (m && m.length === 2 && processorIds.indexOf(m[1])>-1) {\n        found = this;\n      }\n    });\n\n    $(found).trigger('click');\n  }\n  /**\n   * Update hints on the processor names.\n   */\n  function updatePaymentProcessorNames(gcText, stripeText) {\n    $payment_processor.find('[name=\"payment_processor_id\"]').each(function() {\n      var m =this.id.match(/CIVICRM_QFID_(\\d+)_payment_processor_id$/);\n      if (m && m.length === 2) {\n        // Got processor ID. Is it stripe or GoCardless?\n        if (payment_processor_ids.GoCardless.indexOf(m[1]) > -1) {\n          // GoCardless.\n          $(this).next().text(gcText);\n\n        }\n        else if (payment_processor_ids.Stripe.indexOf(m[1]) > -1) {\n          // Stripe.\n          $(this).next().text(stripeText);\n        }\n\n        if ($(this).next().next().prop('tagName') !== 'BR') {\n          // Insert line break before input.\n          $(this).next().next().before('<br/>');\n        }\n      }\n    });\n\n  }\n\n  // Copy CiviCRM's default HTML structure.\n  var $container = $('<div/>').addClass('crm-public-form-item crm-section');\n  $container.append($('<div/>').addClass('label'));\n  var $div = $('<div/>').addClass('content').appendTo($container);\n  $container.append($('<div/>').addClass('clear'));\n\n  var $inUK = $('<input/>')\n    .attr({id: 'in-uk-yes', value: '1', name: 'in-uk', type:'radio'})\n    .on('click', updateUi)\n    .appendTo($div);\n  $('<label/>')\n    .attr('for', 'in-uk-yes')\n    .text(\"I'm in the UK\")\n    .appendTo($div);\n  var $notInUK = $('<input/>')\n    .attr({id: 'in-uk-no', value: '0', name: 'in-uk', type:'radio'})\n    .on('click', updateUi)\n    .appendTo($div);\n  $('<label/>')\n    .attr('for', 'in-uk-no')\n    .text(\"I'm not in the UK\")\n    .appendTo($div);\n\n\n  var $payment_options = $form.find('.payment_options-group');\n  var $payment_processor = $payment_options.find('.payment_processor-section');\n  $payment_processor.hide().before($container);\n\n\n  // Finally, we need to override CiviCRM's events on the price set selection.\n  function overridePriceSetShowHide() {\n    if (!$inUK.is(':checked') && !$notInUK.is(':checked')) {\n      // Neither UK nor not UK is checked, so hide the other options for now.\n      $payment_processor.hide();\n    }\n  }\n  // Apply this when the price set is clicked.\n  $('.price-set-option-content input[type=\"radio\"]').on('click', function() {\n    overridePriceSetShowHide();\n    // In case we are not called first, repeat this after giving 50ms for other processes to work.\n    setTimeout(overridePriceSetShowHide, 50);\n  });\n\n}))(CRM, CRM.$);\n\n"]}